{
    "owner": {
        "reputation": 14334,
        "user_id": 10505040,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/643c7cd13b4cd09ce56bb9ee71914516?s=128&d=identicon&r=PG&f=1",
        "display_name": "Jim Xu",
        "link": "https://stackoverflow.com/users/10505040/jim-xu"
    },
    "is_accepted": true,
    "score": 0,
    "last_activity_date": 1605487833,
    "creation_date": 1605487833,
    "answer_id": 64851383,
    "question_id": 64809121,
    "content_license": "CC BY-SA 4.0",
    "body": "<p>If want to call the Azure function projected by Azure AD in Blazor webassembly client, please refer to the following steps\nIf you want to call Azure function projected by Azure AD in angular application, please refer to the following code</p>\n<ul>\n<li><p><strong>Create Azure AD application to protect function</strong></p>\n<ol>\n<li><p>Register Azure AD application. After doing that, please copy  <strong>Application (client) ID</strong> and the <strong>Directory (tenant) ID</strong></p>\n</li>\n<li><p>Configure <strong>Redirect URI</strong>. Select <strong>Web</strong> and type <code>&lt;app-url&gt;/.auth/login/aad/callback</code>.</p>\n</li>\n<li><p>Enable <strong>Implicit grant flow</strong></p>\n</li>\n<li><p>Define API scope and copy it\n<a href=\"https://i.stack.imgur.com/nALEW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nALEW.png\" alt=\"enter image description here\" /></a></p>\n</li>\n<li><p>Create client secret.</p>\n</li>\n</ol>\n</li>\n<li><p><strong>Enable Azure Active Directory in your App Service app</strong></p>\n</li>\n<li><p><strong>Configure CORS policy in Azure Function</strong>\n<a href=\"https://i.stack.imgur.com/UVm36.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UVm36.png\" alt=\"enter image description here\" /></a></p>\n</li>\n<li><p><strong>Create Client AD application to access function</strong></p>\n<ol>\n<li>Register application</li>\n<li>Enable  <strong>Implicit grant flow</strong></li>\n<li>configure API permissions. Let your client application have permissions to access function</li>\n</ol>\n</li>\n<li><p><strong>Code</strong></p>\n</li>\n</ul>\n<ol>\n<li>Create Custom <code>AuthorizationMessageHandler</code> class</li>\n</ol>\n<pre><code>using Microsoft.AspNetCore.Components;\nusing Microsoft.AspNetCore.Components.WebAssembly.Authentication;\n\npublic class CustomAuthorizationMessageHandler : AuthorizationMessageHandler\n{\n    public CustomAuthorizationMessageHandler(IAccessTokenProvider provider, \n        NavigationManager navigationManager)\n        : base(provider, navigationManager)\n    {\n        ConfigureHandler(\n            authorizedUrls: new[] { &quot;&lt;your function app url&gt;&quot; },\n            scopes: new[] { &quot;&lt;the function app  API scope your define&gt;&quot; });\n    }\n}\n</code></pre>\n<ol start=\"2\">\n<li>Add the following code in <code>Program.cs</code>.</li>\n</ol>\n<pre><code> public static async Task Main(string[] args)\n        {\n            var builder = WebAssemblyHostBuilder.CreateDefault(args);\n            builder.RootComponents.Add&lt;App&gt;(&quot;app&quot;);\n             // register CustomAuthorizationMessageHandler \n            builder.Services.AddScoped&lt;CustomAuthorizationMessageHandler&gt;();\n            // configure httpclient\n            // call the following code please add packageMicrosoft.Extensions.Http 3.1.0\n            builder.Services.AddHttpClient(&quot;ServerAPI&quot;, client =&gt;\n              client.BaseAddress = new Uri(&quot;&lt;your function app url&gt;&quot;))\n                    .AddHttpMessageHandler&lt;CustomAuthorizationMessageHandler&gt;();\n            // register the httpclient\n            builder.Services.AddScoped(sp =&gt; sp.GetRequiredService&lt;IHttpClientFactory&gt;()\n             .CreateClient(&quot;ServerAPI&quot;));\n            // configure Azure AD auth\n            builder.Services.AddMsalAuthentication(options =&gt;\n            {\n                builder.Configuration.Bind(&quot;AzureAd&quot;, options.ProviderOptions.Authentication);\n                options.ProviderOptions.DefaultAccessTokenScopes.Add(&quot;&lt;the function app  API scope your define&gt;&quot;);\n\n\n            });\n\n            await builder.Build().RunAsync();\n        }\n</code></pre>\n<ol start=\"3\">\n<li>Call the API</li>\n</ol>\n<pre><code>@page &quot;/fetchdata&quot;\n@using Microsoft.AspNetCore.Components.WebAssembly.Authentication\n@inject HttpClient Http\n\n&lt;h1&gt;Call Azure Function&lt;/h1&gt;\n\n&lt;p&gt;This component demonstrates fetching data from the server.&lt;/p&gt;\n\n&lt;p&gt;Result: @forecasts&lt;/p&gt;\n\n&lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;CallFun&quot;&gt;Call Function&lt;/button&gt;\n\n@code {\n    private string forecasts;\n\n    protected async Task CallFun()\n    {\n        forecasts = await Http.GetStringAsync(&quot;api/http&quot;);\n    }\n\n\n}\n</code></pre>\n<p><a href=\"https://i.stack.imgur.com/WGZGS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WGZGS.png\" alt=\"enter image description here\" /></a></p>\n"
}