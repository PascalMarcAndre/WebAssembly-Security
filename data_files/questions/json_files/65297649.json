{
    "tags": [
        "c++",
        "qt",
        "qt5",
        "webassembly"
    ],
    "owner": {
        "reputation": 518,
        "user_id": 3924272,
        "user_type": "registered",
        "accept_rate": 53,
        "profile_image": "https://www.gravatar.com/avatar/1b01be61acf18c3d7b41427d4c655cf5?s=128&d=identicon&r=PG&f=1",
        "display_name": "edition",
        "link": "https://stackoverflow.com/users/3924272/edition"
    },
    "is_answered": false,
    "view_count": 63,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1607986853,
    "creation_date": 1607986252,
    "last_edit_date": 1607986853,
    "question_id": 65297649,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/65297649/how-do-i-find-the-cause-of-a-stack-overflow-of-my-qt-application-running-in-weba",
    "title": "How do I find the cause of a stack overflow of my Qt application running in WebAssembly?",
    "body": "<p>I have built a binary using version 1.39.8 of the Emscripten SDK, and used version 5.15.2 of Qt's static libraries and Qt's WebAssembly kit in Qt Creator to build the Application.</p>\n<p>It functions fine on a desktop browser (Ubuntu 20.04.1 LTS, Firefox 83), but on my Android 8.1.0 tablet running Chrome, it fails to load with the Application exiting with a stack overflow error:\n<a href=\"https://i.stack.imgur.com/38Kzq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/38Kzq.png\" alt=\"WASM App crashing on Android tablet displaying stack overflow error\" /></a></p>\n<p>I've tried to find the source of the issue through the Chrome remote debugger, but it won't allow me to navigate to the problematic code in the WASM binary, because its truncated. This back trace is as close as I can get:</p>\n<pre><code>exception thrown: RuntimeError: abort(stack overflow) at Error\n    at jsStackTrace (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1885:17)\n    at stackTrace (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1902:16)\n    at abort (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1660:44)\n    at ___handle_stack_overflow (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1951:7)\n    at dlmalloc (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23922]:0x8f5a79)\n    at operator new(unsigned long) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23014]:0x8e2d73)\n    at AppWindow::AppWindow(QWidget*) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[438]:0xfb31)\n    at main (http://192.168.1.70:30000/xwatch.wasm:wasm-function[437]:0xf9b2)\n    at Module._main (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:12207:32)\n    at callMain (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:13474:15),RuntimeError: abort(stack overflow) at Error\n    at jsStackTrace (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1885:17)\n    at stackTrace (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1902:16)\n    at abort (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1660:44)\n    at ___handle_stack_overflow (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1951:7)\n    at dlmalloc (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23922]:0x8f5a79)\n    at operator new(unsigned long) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23014]:0x8e2d73)\n    at AppWindow::AppWindow(QWidget*) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[438]:0xfb31)\n    at main (http://192.168.1.70:30000/xwatch.wasm:wasm-function[437]:0xf9b2)\n    at Module._main (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:12207:32)\n    at callMain (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:13474:15)\n    at abort (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1666:9)\n    at ___handle_stack_overflow (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:1951:7)\n    at dlmalloc (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23922]:0x8f5a79)\n    at operator new(unsigned long) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[23014]:0x8e2d73)\n    at AppWindow::AppWindow(QWidget*) (http://192.168.1.70:30000/xwatch.wasm:wasm-function[438]:0xfb31)\n    at main (http://192.168.1.70:30000/xwatch.wasm:wasm-function[437]:0xf9b2)\n    at Module._main (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:12207:32)\n    at callMain (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:13474:15)\n    at doRun (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:13535:23)\n    at eval (eval at completeLoadEmscriptenModule (http://192.168.1.70:30000/qtloader.js:443:14), &lt;anonymous&gt;:13546:7)\n</code></pre>\n<p>I think it may be happening in AppWindow's constructor; here's its code:</p>\n<pre><code>AppWindow::AppWindow(QWidget *parent)\n    : QMainWindow(parent), ui(new Ui::AppWindow) {\n  ui-&gt;setupUi(this);\n  lapCircle = new LapCircle(this);\n  lapCircle-&gt;resize(512, 512);\n  lapCircle-&gt;move(0,0);\n  ui-&gt;verticalLayout-&gt;insertWidget(0, lapCircle);\n  updateTimer = new QTimer(this);\n  updateTimer-&gt;setTimerType(Qt::TimerType::CoarseTimer);\n  currentTimeMS = 0;\n  uiFont = QFont(&quot;IBM Plex Sans&quot;);\n  setFont(uiFont);\n  isVisuallyStopped = false;\n  lastDeadlineTimerValue = 0;\n  updateTimer-&gt;setInterval(2);\n  connect(updateTimer, &amp;QTimer::timeout, this, [&amp;](){\n    if (!isVisuallyStopped) {\n      currentTimeMS += QDeadlineTimer::current().deadline() - lastDeadlineTimerValue;\n      updateTimeLabel();\n      lastDeadlineTimerValue = QDeadlineTimer::current().deadline();\n    }\n  });\n  connect(ui-&gt;btnStart, &amp;QPushButton::clicked, this, [&amp;]() {\n    currentTimeMS += (lastDeadlineTimerValue - QDeadlineTimer::current().deadline());\n    isVisuallyStopped = false;\n    updateTimer-&gt;start();\n  });\n  connect(ui-&gt;btnStop, &amp;QPushButton::clicked, this, [&amp;]() {\n    isVisuallyStopped = true;\n    updateTimer-&gt;stop();\n  });\n  connect(ui-&gt;btnReset, &amp;QPushButton::clicked, this, [&amp;]() {\n    currentTimeMS = 0;\n    updateTimeLabel();\n  });\n}\n</code></pre>\n<p>How can I find out where the problematic code is in my WebAssembly binary?</p>\n"
}