{
    "tags": [
        "c#",
        "azure-devops",
        "azure-pipelines",
        "blazor",
        "blazor-webassembly"
    ],
    "owner": {
        "reputation": 365,
        "user_id": 8655660,
        "user_type": "registered",
        "profile_image": "https://www.gravatar.com/avatar/9e4f7815f77d908ec75eecbf7d86b474?s=128&d=identicon&r=PG&f=1",
        "display_name": "Cedervall",
        "link": "https://stackoverflow.com/users/8655660/cedervall"
    },
    "is_answered": false,
    "view_count": 88,
    "answer_count": 0,
    "score": 1,
    "last_activity_date": 1611240491,
    "creation_date": 1610976652,
    "last_edit_date": 1611240491,
    "question_id": 65775487,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/65775487/blazor-webassembly-pwa-loses-functionality-and-style-in-devops-pipeline",
    "title": "Blazor WebAssembly PWA loses functionality and style in DevOps Pipeline",
    "body": "<p>When first opening the application or after doing a hard reload the isolated CSS does not load. The same is if you open up the application on mobile. In addition, the promps to download the PWA doesn't show.</p>\n<p>What I have is a Blazor WebAssembly PWA. The solution has two projects 'server' and 'client'. <br />\nThe server project contains the start up, caching etc.<br />\nThe client contains the frontend.</p>\n<p>The solution is hosted in an Azure App Service (Deployment Slot).</p>\n<p>If deploying manually to the slot everything is fine.\n(Download the publish profile from Azure AppService and publish server project)</p>\n<p>Now to the problem: <br />\nI set up two pipelines, a build pipeline and a release pipeline.</p>\n<p>The build pipeline:</p>\n<pre><code>trigger:\n- master\n\npool:\n  vmImage: 'windows-latest'\n\nvariables:\n  solution: '**/*.sln'\n  buildPlatform: 'Any CPU'\n  buildConfiguration: 'Release'\n\nsteps:\n- task: NuGetToolInstaller@1\n\n- task: NuGetCommand@2\n  inputs:\n    restoreSolution: '$(solution)'\n\n- task: VSBuild@1\n  inputs:\n    solution: '$(solution)'\n    msbuildArgs: '/p:DeployOnBuild=true /p:WebPublishMethod=Package /p:PackageAsSingleFile=true /p:SkipInvalidConfigurations=true /p:PackageLocation=&quot;$(build.artifactStagingDirectory)&quot;'\n    platform: '$(buildPlatform)'\n    configuration: '$(buildConfiguration)'\n\n- task: VSTest@2\n  inputs:\n    platform: '$(buildPlatform)'\n    configuration: '$(buildConfiguration)'\n\n- task: PublishBuildArtifacts@1\n  inputs:\n    PathtoPublish: '$(Build.ArtifactStagingDirectory)'\n    ArtifactName: 'drop'\n    publishLocation: 'Container'\n\n</code></pre>\n<p>The release pipline\n(Has some CI/CD settings)</p>\n<p>Due to building a solution with multiple project I get multiple Zip-files in my drop artifact. The server one is the one I pick up and deploy to the same AppService.</p>\n<p>The pipelines work. The problem arises first when the application is opened. If I publish manually everything looks fine and I get the prompt to download the app. However, if I use the pipeline neither the correct CSS is loaded (at least not the isolated) or the prompt to download the PWA is shown.</p>\n<p>Client csproj</p>\n<pre><code>&lt;Project Sdk=&quot;Microsoft.NET.Sdk.BlazorWebAssembly&quot;&gt;\n\n    &lt;PropertyGroup&gt;\n        &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;\n        &lt;ServiceWorkerAssetsManifest&gt;service-worker-assets.js&lt;/ServiceWorkerAssetsManifest&gt;\n    &lt;/PropertyGroup&gt;\n\n    &lt;!--Standard vs studio warnings to ignore +\n  https://docs.microsoft.com/en-us/dotnet/csharp/misc/cs0649, disable warnings for variables that are never assigned (values can be changed by dubbel binding) --&gt;\n    &lt;PropertyGroup Condition=&quot;'$(Configuration)|$(Platform)'=='Debug|AnyCPU'&quot;&gt;\n        &lt;NoWarn&gt;1701;1702;0649&lt;/NoWarn&gt;\n    &lt;/PropertyGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;PackageReference Include=&quot;LibSassBuilder&quot; Version=&quot;1.4.0&quot; /&gt;\n        &lt;PackageReference Include=&quot;MatBlazor&quot; Version=&quot;2.8.0&quot; /&gt;\n        &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly&quot; Version=&quot;5.0.0&quot; /&gt;\n        &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly.DevServer&quot; Version=&quot;5.0.0&quot; PrivateAssets=&quot;all&quot; /&gt;\n        &lt;PackageReference Include=&quot;Microsoft.Extensions.Http&quot; Version=&quot;5.0.0&quot; /&gt;\n        &lt;PackageReference Include=&quot;System.Net.Http.Json&quot; Version=&quot;5.0.0&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;ProjectReference Include=&quot;..\\..\\DeviationModels\\DeviationModels.csproj&quot; /&gt;\n        &lt;ProjectReference Include=&quot;..\\..\\DriverModels\\DriverModels.csproj&quot; /&gt;\n        &lt;ProjectReference Include=&quot;..\\..\\SafetyModels\\SafetyModels.csproj&quot; /&gt;\n        &lt;ProjectReference Include=&quot;..\\Shared\\BlazorDriverApp.Shared.csproj&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;ServiceWorker Include=&quot;wwwroot\\service-worker.js&quot; PublishedContent=&quot;wwwroot\\service-worker.published.js&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;Content Update=&quot;wwwroot\\css\\general.scss&quot;&gt;\n            &lt;CopyToOutputDirectory&gt;Never&lt;/CopyToOutputDirectory&gt;\n        &lt;/Content&gt;\n    &lt;/ItemGroup&gt;\n\n\n    &lt;Target Name=&quot;AfterBuild&quot;&gt;\n        &lt;ItemGroup&gt;\n            &lt;Content Include=&quot;**\\*.js&quot; /&gt;\n            &lt;Content Include=&quot;**\\*.css&quot; /&gt;\n        &lt;/ItemGroup&gt;\n    &lt;/Target&gt;\n\n&lt;/Project&gt;\n</code></pre>\n<p>Server csproj</p>\n<pre><code>&lt;Project Sdk=&quot;Microsoft.NET.Sdk.Web&quot;&gt;\n\n    &lt;PropertyGroup&gt;\n        &lt;TargetFramework&gt;net5.0&lt;/TargetFramework&gt;\n    &lt;/PropertyGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;PackageReference Include=&quot;Microsoft.AspNetCore.Components.WebAssembly.Server&quot; Version=&quot;5.0.0&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;ProjectReference Include=&quot;..\\Client\\BlazorDriverApp.Client.csproj&quot; /&gt;\n        &lt;ProjectReference Include=&quot;..\\Shared\\BlazorDriverApp.Shared.csproj&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;ItemGroup&gt;\n        &lt;Watch Include=&quot;..\\**\\*.scss&quot; /&gt;\n    &lt;/ItemGroup&gt;\n\n    &lt;Target Name=&quot;AfterBuild&quot;&gt;\n        &lt;ItemGroup&gt;\n            &lt;Content Include=&quot;..\\**\\*.js&quot; /&gt;\n            &lt;Content Include=&quot;..\\**\\*.css&quot; /&gt;\n        &lt;/ItemGroup&gt;\n    &lt;/Target&gt;\n\n&lt;/Project&gt;\n\n</code></pre>\n"
}