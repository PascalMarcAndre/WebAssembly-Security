{
    "tags": [
        "javascript",
        "android",
        "google-chrome",
        "camera",
        "webrtc"
    ],
    "owner": {
        "reputation": 2019,
        "user_id": 213057,
        "user_type": "registered",
        "accept_rate": 75,
        "profile_image": "https://www.gravatar.com/avatar/9d8465ac78b6e3c051a2dab05d8ff6ae?s=128&d=identicon&r=PG",
        "display_name": "DoDo",
        "link": "https://stackoverflow.com/users/213057/dodo"
    },
    "is_answered": false,
    "view_count": 2742,
    "answer_count": 1,
    "score": 19,
    "last_activity_date": 1605001966,
    "creation_date": 1578433350,
    "last_edit_date": 1578482658,
    "question_id": 59636464,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/59636464/how-to-select-proper-backfacing-camera-in-javascript",
    "title": "How to select proper backfacing camera in Javascript?",
    "body": "<p>I am using <code>navigator.mediaDevices.getUserMedia</code> to open <code>MediaStream</code> from camera device within a web browser. My app wants to do some realtime image processing in WebAssembly and for that, I need to provide a live stream of images directly from the camera.</p>\n\n<p>My solution works pretty well on most devices, however, I have a problem on devices with multiple back-facing cameras, such as Samsung Galaxy S10 on Google Chrome for Android. The problem is that the following snippet:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const constraints = {\n    audio: false,\n    video: {\n        width: { min: 640, ideal: 1280, max: 1920 },\n        height: { min: 480, ideal: 720, max: 1080 },\n        facingMode: { ideal: 'environment' },\n    }\n};\nconst stream = await navigator.mediaDevices.getUserMedia( constraints );\n</code></pre>\n\n<p>always opens a wrong camera - the wide-lens camera which does not support autofocus and provides images that are too distorted for my code. The wide-lens camera is good for landscape photography but it is terrible for barcode and text scanning.</p>\n\n<p>How can I select the correct camera by using <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\" rel=\"noreferrer\">MediaTrackConstraints</a>? I've tried adding also </p>\n\n<pre class=\"lang-js prettyprint-override\"><code>focusMode: { ideal: 'continuous' }\n</code></pre>\n\n<p>to the constraints (according to <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints\" rel=\"noreferrer\">MDN documentation</a>, this should be a possible constraint for image tracks) but it does not seem to work.</p>\n\n<p>I've also tried enumerating all devices (from <a href=\"https://stackoverflow.com/a/38395489/213057\">this SO answer</a>), but I don't know how to properly select the correct camera.</p>\n\n<p>Notably, this code snippet:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const devices = await navigator.mediaDevices.enumerateDevices();\ndevices.forEach( ( device: MediaDeviceInfo ) =&gt; {\n    console.log( \"Found device: \" + JSON.stringify( device ) );\n});\n</code></pre>\n\n<p>produces the following console output:</p>\n\n<pre><code>Found device: {\"deviceId\":\"default\",\"kind\":\"audioinput\",\"label\":\"\",\"groupId\":\"4852f187ff6a41e6d3fb3ba41c4897f46bd8ff153579da6fcb8f485432a32f66\"}\nFound device: {\"deviceId\":\"86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d\",\"kind\":\"audioinput\",\"label\":\"\",\"groupId\":\"c2cfc78763f7668263b0033c44d0f906ca0f33264ebfa6b96e9846265a21ff09\"}\nFound device: {\"deviceId\":\"4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c\",\"kind\":\"audioinput\",\"label\":\"\",\"groupId\":\"7a86866423279d7b1e12dbe585a14a677a2f2df4e41ec5d388b6c90f7319e88d\"}\nFound device: {\"deviceId\":\"b46cd34041256d2cf72ed6e8500f71beb698a01b8c47c7c04801c20c47630978\",\"kind\":\"videoinput\",\"label\":\"camera2 1, facing front\",\"groupId\":\"b1bd1a6ed8a87cd07ca0fa84744ae515b1ab2bed61cc257765c37d3426269af7\"}\nFound device: {\"deviceId\":\"39d63e8a9764261b73785c90beb58399997a5a4de56b3238fff6676c738331a6\",\"kind\":\"videoinput\",\"label\":\"camera2 3, facing front\",\"groupId\":\"a23c2f0e311c0ca0c80a56a8b5ff7c1f8aa093df4f6ac080b051c1d95f60a94e\"}\nFound device: {\"deviceId\":\"4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c\",\"kind\":\"videoinput\",\"label\":\"camera2 2, facing back\",\"groupId\":\"9b6b1a429e0db2d5094ddebe205d23309464650d8bcd585b2fe4ae8196b86f1c\"}\nFound device: {\"deviceId\":\"86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d\",\"kind\":\"videoinput\",\"label\":\"camera2 0, facing back\",\"groupId\":\"0de9556e1253763d7203b3b9e5db313cf89e05dd4bdd4ea0c5aff52d2952cf11\"}\nFound device: {\"deviceId\":\"default\",\"kind\":\"audiooutput\",\"label\":\"\",\"groupId\":\"default\"}\n</code></pre>\n\n<p>The correct camera has the label <code>camera2 0, facing back</code> and for some reason Chrome always selects <code>camera2 2, facing back</code>.</p>\n\n<p>Of course, I could hardcode the selection of camera by its label, but that would work only on Samsung Galaxy S10 and I would like my code to work on any device having multiple back-facing cameras.</p>\n\n<p>I still haven't tried running my page on iPhone 11 Pro (which has 3 back-facing cameras), but it works correctly on Huawei Mate 30 Pro (4 back-facing cameras) and Oppo Reno 9. Also, the problem seems to related to Google Chrome on Android. When I open my page on Firefox for Android, the browser asks me to select which camera should be used just after closing the camera permission dialog and only if multiple cameras satisfy the given constraints. That is quite fair, as it makes it possible to select the correct camera for performing the scan. I haven't tried opening my page on Samsung Internet and Opera browsers (yet).</p>\n\n<p>Since Google Chrome is the most popular web browser on Android, I would be even satisfied with Chrome-specific solution, but of course, the best would be to get answer that works everywhere.</p>\n\n<h2>EDIT</h2>\n\n<p>Following the comment from <a href=\"https://stackoverflow.com/questions/59636464/how-to-select-proper-backfacing-camera-in-javascript#comment105438909_59636464\">jib</a>, I've tried also using <code>focusDistance</code> with </p>\n\n<pre class=\"lang-js prettyprint-override\"><code>focusDistance: { min: 0.05, ideal: 0.12, max: 0.3 }\n</code></pre>\n\n<p>and it didn't help.</p>\n\n<p>I've also tried logging the outputs of <code>getSettings</code> and <code>getCapabilities</code> with the following snippet:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const devices = await navigator.mediaDevices.enumerateDevices();\nlet videoDevices: Array&lt; MediaDeviceInfo &gt; = [];\ndevices.forEach( ( device: MediaDeviceInfo ) =&gt; {\n    if ( device.kind == 'videoinput' ) {\n        console.log( \"Found video device: \" + JSON.stringify( device ) );\n        videoDevices.push( device );\n    }\n});\n\nconsole.log( '' );\n\n// open every video device and dump its characteristics\nfor ( let i in videoDevices ) {\n    const device = videoDevices[ i ];\n    console.log( \"Opening video device \" + device.deviceId + \" (\" + device.label + \")\" );\n    const stream = await navigator.mediaDevices.getUserMedia( { video: { deviceId: { exact: device.deviceId } } } );\n    stream.getVideoTracks().forEach( track =&gt; {\n            const capabilities = track.getCapabilities();\n            console.log( \"Track capabilities: \" + JSON.stringify( capabilities ) );\n            const settings = track.getSettings();\n            console.log( \"Track settings: \" + JSON.stringify( settings ) );\n            console.log( '' );\n        }\n    )\n\n    stream.getTracks().forEach( track =&gt; track.stop() );\n}\n</code></pre>\n\n<p>The output is the following:</p>\n\n<pre><code>Found video device: {\"deviceId\":\"b46cd34041256d2cf72ed6e8500f71beb698a01b8c47c7c04801c20c47630978\",\"kind\":\"videoinput\",\"label\":\"camera2 1, facing front\",\"groupId\":\"500dd57c6795399100a5ca8bf7f0cc4d7ed8b1bcb0877101d1bef7eb74921868\"}\nFound video device: {\"deviceId\":\"39d63e8a9764261b73785c90beb58399997a5a4de56b3238fff6676c738331a6\",\"kind\":\"videoinput\",\"label\":\"camera2 3, facing front\",\"groupId\":\"245693c8d34be77fe2f15be31b6054a19edb8ea9ed4116d966d2a03695bebebe\"}\nFound video device: {\"deviceId\":\"4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c\",\"kind\":\"videoinput\",\"label\":\"camera2 2, facing back\",\"groupId\":\"c219595df2c2a430aea7007f64e6ce8fbfa783b038cf53069336361cc07e71af\"}\nFound video device: {\"deviceId\":\"86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d\",\"kind\":\"videoinput\",\"label\":\"camera2 0, facing back\",\"groupId\":\"96a68b6d6429786317e3b2c4773082604c5ab9a5cdaaf49c481878e40d67e987\"}\n\nOpening video device b46cd34041256d2cf72ed6e8500f71beb698a01b8c47c7c04801c20c47630978 (camera2 1, facing front)\nTrack capabilities: {\"aspectRatio\":{\"max\":3216,\"min\":0.0004528985507246377},\"deviceId\":\"b46cd34041256d2cf72ed6e8500f71beb698a01b8c47c7c04801c20c47630978\",\"facingMode\":[\"user\"],\"frameRate\":{\"max\":30,\"min\":0},\"groupId\":\"500dd57c6795399100a5ca8bf7f0cc4d7ed8b1bcb0877101d1bef7eb74921868\",\"height\":{\"max\":2208,\"min\":1},\"resizeMode\":[\"none\",\"crop-and-scale\"],\"width\":{\"max\":3216,\"min\":1}}\nTrack settings: {\"aspectRatio\":1.3333333333333333,\"deviceId\":\"b46cd34041256d2cf72ed6e8500f71beb698a01b8c47c7c04801c20c47630978\",\"facingMode\":\"user\",\"frameRate\":30,\"groupId\":\"500dd57c6795399100a5ca8bf7f0cc4d7ed8b1bcb0877101d1bef7eb74921868\",\"height\":480,\"resizeMode\":\"none\",\"width\":640}\n\nOpening video device 39d63e8a9764261b73785c90beb58399997a5a4de56b3238fff6676c738331a6 (camera2 3, facing front)\nTrack capabilities: {\"aspectRatio\":{\"max\":3968,\"min\":0.0003654970760233918},\"deviceId\":\"39d63e8a9764261b73785c90beb58399997a5a4de56b3238fff6676c738331a6\",\"facingMode\":[\"user\"],\"frameRate\":{\"max\":30,\"min\":0},\"groupId\":\"245693c8d34be77fe2f15be31b6054a19edb8ea9ed4116d966d2a03695bebebe\",\"height\":{\"max\":2736,\"min\":1},\"resizeMode\":[\"none\",\"crop-and-scale\"],\"width\":{\"max\":3968,\"min\":1}}\nTrack settings: {\"aspectRatio\":1.3333333333333333,\"deviceId\":\"39d63e8a9764261b73785c90beb58399997a5a4de56b3238fff6676c738331a6\",\"facingMode\":\"user\",\"frameRate\":30,\"groupId\":\"245693c8d34be77fe2f15be31b6054a19edb8ea9ed4116d966d2a03695bebebe\",\"height\":480,\"resizeMode\":\"none\",\"width\":640}\n\nOpening video device 4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c (camera2 2, facing back)\nTrack capabilities: {\"aspectRatio\":{\"max\":4608,\"min\":0.00028935185185185184},\"deviceId\":\"4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c\",\"facingMode\":[\"environment\"],\"frameRate\":{\"max\":60,\"min\":0},\"groupId\":\"c219595df2c2a430aea7007f64e6ce8fbfa783b038cf53069336361cc07e71af\",\"height\":{\"max\":3456,\"min\":1},\"resizeMode\":[\"none\",\"crop-and-scale\"],\"width\":{\"max\":4608,\"min\":1}}\nTrack settings: {\"aspectRatio\":1.3333333333333333,\"deviceId\":\"4d5fecf5a3eee5d41812bb6c34efe6d25342af9448628b006561c7385a22ca6c\",\"facingMode\":\"environment\",\"frameRate\":60,\"groupId\":\"c219595df2c2a430aea7007f64e6ce8fbfa783b038cf53069336361cc07e71af\",\"height\":480,\"resizeMode\":\"none\",\"width\":640}\n\nOpening video device 86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d (camera2 0, facing back)\nTrack capabilities: {\"aspectRatio\":{\"max\":4032,\"min\":0.00033068783068783067},\"deviceId\":\"86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d\",\"facingMode\":[\"environment\"],\"frameRate\":{\"max\":60,\"min\":0},\"groupId\":\"96a68b6d6429786317e3b2c4773082604c5ab9a5cdaaf49c481878e40d67e987\",\"height\":{\"max\":3024,\"min\":1},\"resizeMode\":[\"none\",\"crop-and-scale\"],\"width\":{\"max\":4032,\"min\":1}}\nTrack settings: {\"aspectRatio\":1.3333333333333333,\"deviceId\":\"86d4706b0bf160ff12fa75535173edcc68d4fa7ad5e00ec186cb1285ff22869d\",\"facingMode\":\"environment\",\"frameRate\":60,\"groupId\":\"96a68b6d6429786317e3b2c4773082604c5ab9a5cdaaf49c481878e40d67e987\",\"height\":480,\"resizeMode\":\"none\",\"width\":640}\n</code></pre>\n\n<p>So, still, nothing to distinguish between <code>camera2 0, facing back</code> and <code>camera2 2, facing back</code>, except different maximum available resolution.</p>\n\n<p>I've also tried with Samsung Internet browser and it behaves the same as Google Chrome.</p>\n\n<p>Any other ideas (except <em>iterating over all back-facing camera and selecting the one with least resolution</em>)?</p>\n"
}