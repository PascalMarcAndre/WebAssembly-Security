{
    "tags": [
        "c++",
        "boost",
        "makefile",
        "cmake",
        "webassembly"
    ],
    "owner": {
        "reputation": 1060,
        "user_id": 5294048,
        "user_type": "registered",
        "profile_image": "https://graph.facebook.com/822172617902621/picture?type=large",
        "display_name": "Pedro Mutter",
        "link": "https://stackoverflow.com/users/5294048/pedro-mutter"
    },
    "is_answered": true,
    "view_count": 1045,
    "answer_count": 1,
    "score": 4,
    "last_activity_date": 1580197479,
    "creation_date": 1578760080,
    "last_edit_date": 1578929006,
    "question_id": 59696327,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/59696327/compile-big-c-project-that-uses-cmake-to-webassembly",
    "title": "Compile big C++ project that uses CMake to WebAssembly",
    "body": "<p>I've been trying to compile a huge C++ project, that uses CMake to build the project, to <strong>wasm</strong>. I have almost no experience with CMake files and I am fighting this battle for months now.</p>\n\n<p>First I tried to install the webassembly compiler in my machine, following <a href=\"https://webassembly.org/getting-started/developers-guide/\" rel=\"nofollow noreferrer\">this</a> link. I successfully installed it and ran the \"hello world\" project. But when a tried to build the project, changing the <code>cmake</code> and <code>make</code> commands to <code>emcmake</code> and <code>emmake</code>, but it began complains about missing dependency libraries (boost and lua).</p>\n\n<p>Then I tried with a docker image, and I built the following <code>Dockerfile</code>:</p>\n\n<pre><code>FROM trzeci/emscripten AS builder\n\nRUN apt-get update &amp;&amp; \\\n apt-get install -y build-essential \\\n    cmake \\\n    git-core \\\n    libboost-atomic-dev \\\n    libboost-chrono-dev \\\n    libboost-date-time-dev \\\n    libboost-filesystem-dev \\\n    libboost-system-dev \\\n    libboost-thread-dev \\\n    libglew-dev \\\n    liblua5.1-0-dev \\\n    libncurses5-dev \\\n    libopenal-dev \\\n    libssl-dev \\\n    libvorbis-dev \\\n    mercurial \\\n    zlib1g-dev &amp;&amp; \\\n apt-get clean &amp;&amp; apt-get autoclean\n\nWORKDIR /\nRUN hg clone -r stable-3.0 http://hg.icculus.org/icculus/physfs/\nWORKDIR /physfs/build/\nRUN cmake ..\nRUN make -j$(nproc)\nRUN make install\n\nCOPY ./src/ /otclient/src/.\nCOPY CMakeLists.txt /otclient/.\nWORKDIR /otclient/build/\nRUN emconfigure cmake -DCMAKE_CXX_LINK_FLAGS=-no-pie -DCMAKE_BUILD_TYPE=Release -DEMSCRIPTEN_GENERATE_BITCODE_STATIC_LIBRARIES=1 ..\nRUN make -j$(nproc)\n\nFROM trzeci/emscripten\nRUN apt-get update; \\\n  apt-get install -y \\\n    libglew2.0 \\\n    libopenal1; \\\n  apt-get clean &amp;&amp; apt-get autoclean\nCOPY --from=builder /otclient/build/otclient /otclient/bin/otclient\nCOPY ./data/ /otclient/data/.\nCOPY ./mods/ /otclient/mods/.\nCOPY ./modules/ /otclient/modules/.\nCOPY ./init.lua /otclient/.\nWORKDIR /otclient\nEXPOSE 8080:8080\nRUN npm install http-server -g\nCMD [\"http-server\", \"./bin/\", \"-p\", \"8080\"]\n</code></pre>\n\n<p>But the same error appears, missing libraries.</p>\n\n<pre><code>CMake Error at /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:2147 (message):\n  Unable to find the requested Boost libraries.\n\n  Unable to find the Boost header files.  Please set BOOST_ROOT to the root\n  directory containing Boost or BOOST_INCLUDEDIR to the directory containing\n  Boost's headers.\nCall Stack (most recent call first):\n  src/framework/CMakeLists.txt:205 (find_package)\n  CMakeLists.txt:36 (include)\n\n\nCMake Error at /opt/cmake/share/cmake-3.14/Modules/FindPackageHandleStandardArgs.cmake:137 (message):\n  Could NOT find Lua (missing: LUA_LIBRARY LUA_INCLUDE_DIR)\nCall Stack (most recent call first):\n  /opt/cmake/share/cmake-3.14/Modules/FindPackageHandleStandardArgs.cmake:378 (_FPHSA_FAILURE_MESSAGE)\n  src/framework/cmake/FindLua.cmake:17 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)\n  src/framework/CMakeLists.txt:217 (find_package)\n  CMakeLists.txt:36 (include)\n\n</code></pre>\n\n<p>I already tried to follow <a href=\"https://medium.com/@tdeniffel/pragmatic-compiling-from-c-to-webassembly-a-guide-a496cc5954b8\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://emscripten.org/docs/compiling/WebAssembly.html#webassembly\" rel=\"nofollow noreferrer\">this</a> links and nothing. Someone with experience with CMake/WebAssembly could help me, please?</p>\n\n<p>The project link is <a href=\"https://github.com/MutterPedro/otclient\" rel=\"nofollow noreferrer\">this</a>. The CMake files are too big to post here...</p>\n\n<p><strong>Edit</strong>\nLogs from after adding <code>-DBoost_DEBUG=ON</code> option:</p>\n\n<pre><code>Step 12/24 : RUN emconfigure cmake -DCMAKE_CXX_LINK_FLAGS=-no-pie -DCMAKE_BUILD_TYPE=Release -DEMSCRIPTEN_GENERATE_BITCODE_STATIC_LIBRARIES=1 -DBoost_DEBUG=ON ..\n ---&gt; Running in e0ea96547712\nCMake Error at CMakeLists.txt:21 (set):\n  set given invalid arguments for CACHE mode.\n\n\n-- Setting compilation target to WASM\nCMake Warning (dev) at src/framework/CMakeLists.txt:152 (set):\n  implicitly converting 'Git commit string (intended for releases)' to\n  'STRING' type.\nCall Stack (most recent call first):\n  CMakeLists.txt:36 (include)\nThis warning is for project developers.  Use -Wno-dev to suppress it.\n\nCMake Warning (dev) at src/framework/CMakeLists.txt:153 (set):\n  implicitly converting 'Git revision string (intended for releases)' to\n  'STRING' type.\nCall Stack (most recent call first):\n  CMakeLists.txt:36 (include)\nThis warning is for project developers.  Use -Wno-dev to suppress it.\n\n-- Performing Test COMPILER_KNOWS_CXX11\n-- Performing Test COMPILER_KNOWS_CXX11 - Success\n-- Performing Test COMPILER_KNOWS_STDLIB\n-- Performing Test COMPILER_KNOWS_STDLIB - Success\n-- Link to static libraries: ON\n-- Build type: Release\n-- Build commit: devel\n-- Build revision: 0\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1196 ] _boost_TEST_VERSIONS = 1.70.0;1.70;1.69.0;1.69;1.68.0;1.68;1.67.0;1.67;1.66.0;1.66;1.65.1;1.65.0;1.65;1.64.0;1.64;1.63.0;1.63;1.62.0;1.62;1.61.0;1.61;1.60.0;1.60;1.59.0;1.59;1.58.0;1.58;1.57.0;1.57;1.56.0;1.56;1.55.0;1.55;1.54.0;1.54;1.53.0;1.53;1.52.0;1.52;1.51.0;1.51;1.50.0;1.50;1.49.0;1.49;1.48.0;1.48\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1198 ] Boost_USE_MULTITHREADED = ON\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1200 ] Boost_USE_STATIC_LIBS = ON\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1202 ] Boost_USE_STATIC_RUNTIME = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1204 ] Boost_ADDITIONAL_VERSIONS = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1206 ] Boost_NO_SYSTEM_PATHS = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1274 ] Declared as CMake or Environmental Variables:\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1276 ]   BOOST_ROOT = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1278 ]   BOOST_INCLUDEDIR = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1280 ]   BOOST_LIBRARYDIR = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1282 ] _boost_TEST_VERSIONS = 1.70.0;1.70;1.69.0;1.69;1.68.0;1.68;1.67.0;1.67;1.66.0;1.66;1.65.1;1.65.0;1.65;1.64.0;1.64;1.63.0;1.63;1.62.0;1.62;1.61.0;1.61;1.60.0;1.60;1.59.0;1.59;1.58.0;1.58;1.57.0;1.57;1.56.0;1.56;1.55.0;1.55;1.54.0;1.54;1.53.0;1.53;1.52.0;1.52;1.51.0;1.51;1.50.0;1.50;1.49.0;1.49;1.48.0;1.48\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1357 ] Include debugging info:\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1359 ]   _boost_INCLUDE_SEARCH_DIRS = PATHS;C:/boost/include;C:/boost;/sw/local/include\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1361 ]   _boost_PATH_SUFFIXES = boost-1_70_0;boost_1_70_0;boost/boost-1_70_0;boost/boost_1_70_0;boost-1_70;boost_1_70;boost/boost-1_70;boost/boost_1_70;boost-1_69_0;boost_1_69_0;boost/boost-1_69_0;boost/boost_1_69_0;boost-1_69;boost_1_69;boost/boost-1_69;boost/boost_1_69;boost-1_68_0;boost_1_68_0;boost/boost-1_68_0;boost/boost_1_68_0;boost-1_68;boost_1_68;boost/boost-1_68;boost/boost_1_68;boost-1_67_0;boost_1_67_0;boost/boost-1_67_0;boost/boost_1_67_0;boost-1_67;boost_1_67;boost/boost-1_67;boost/boost_1_67;boost-1_66_0;boost_1_66_0;boost/boost-1_66_0;boost/boost_1_66_0;boost-1_66;boost_1_66;boost/boost-1_66;boost/boost_1_66;boost-1_65_1;boost_1_65_1;boost/boost-1_65_1;boost/boost_1_65_1;boost-1_65_0;boost_1_65_0;boost/boost-1_65_0;boost/boost_1_65_0;boost-1_65;boost_1_65;boost/boost-1_65;boost/boost_1_65;boost-1_64_0;boost_1_64_0;boost/boost-1_64_0;boost/boost_1_64_0;boost-1_64;boost_1_64;boost/boost-1_64;boost/boost_1_64;boost-1_63_0;boost_1_63_0;boost/boost-1_63_0;boost/boost_1_63_0;boost-1_63;boost_1_63;boost/boost-1_63;boost/boost_1_63;boost-1_62_0;boost_1_62_0;boost/boost-1_62_0;boost/boost_1_62_0;boost-1_62;boost_1_62;boost/boost-1_62;boost/boost_1_62;boost-1_61_0;boost_1_61_0;boost/boost-1_61_0;boost/boost_1_61_0;boost-1_61;boost_1_61;boost/boost-1_61;boost/boost_1_61;boost-1_60_0;boost_1_60_0;boost/boost-1_60_0;boost/boost_1_60_0;boost-1_60;boost_1_60;boost/boost-1_60;boost/boost_1_60;boost-1_59_0;boost_1_59_0;boost/boost-1_59_0;boost/boost_1_59_0;boost-1_59;boost_1_59;boost/boost-1_59;boost/boost_1_59;boost-1_58_0;boost_1_58_0;boost/boost-1_58_0;boost/boost_1_58_0;boost-1_58;boost_1_58;boost/boost-1_58;boost/boost_1_58;boost-1_57_0;boost_1_57_0;boost/boost-1_57_0;boost/boost_1_57_0;boost-1_57;boost_1_57;boost/boost-1_57;boost/boost_1_57;boost-1_56_0;boost_1_56_0;boost/boost-1_56_0;boost/boost_1_56_0;boost-1_56;boost_1_56;boost/boost-1_56;boost/boost_1_56;boost-1_55_0;boost_1_55_0;boost/boost-1_55_0;boost/boost_1_55_0;boost-1_55;boost_1_55;boost/boost-1_55;boost/boost_1_55;boost-1_54_0;boost_1_54_0;boost/boost-1_54_0;boost/boost_1_54_0;boost-1_54;boost_1_54;boost/boost-1_54;boost/boost_1_54;boost-1_53_0;boost_1_53_0;boost/boost-1_53_0;boost/boost_1_53_0;boost-1_53;boost_1_53;boost/boost-1_53;boost/boost_1_53;boost-1_52_0;boost_1_52_0;boost/boost-1_52_0;boost/boost_1_52_0;boost-1_52;boost_1_52;boost/boost-1_52;boost/boost_1_52;boost-1_51_0;boost_1_51_0;boost/boost-1_51_0;boost/boost_1_51_0;boost-1_51;boost_1_51;boost/boost-1_51;boost/boost_1_51;boost-1_50_0;boost_1_50_0;boost/boost-1_50_0;boost/boost_1_50_0;boost-1_50;boost_1_50;boost/boost-1_50;boost/boost_1_50;boost-1_49_0;boost_1_49_0;boost/boost-1_49_0;boost/boost_1_49_0;boost-1_49;boost_1_49;boost/boost-1_49;boost/boost_1_49;boost-1_48_0;boost_1_48_0;boost/boost-1_48_0;boost/boost_1_48_0;boost-1_48;boost_1_48;boost/boost-1_48;boost/boost_1_48\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1462 ] Boost_LIB_PREFIX = \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1464 ] Boost_NAMESPACE = boost\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1499 ] guessed _boost_COMPILER = -clang60\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1509 ] _boost_MULTITHREADED = -mt\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1593 ] _boost_RELEASE_ABI_TAG = -\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1595 ] _boost_DEBUG_ABI_TAG = -d\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1658 ] _boost_LIBRARY_SEARCH_DIRS_RELEASE = Boost_INCLUDE_DIR-NOTFOUND/lib;Boost_INCLUDE_DIR-NOTFOUND/../lib;Boost_INCLUDE_DIR-NOTFOUND/stage/lib;PATHS;C:/boost/lib;C:/boost;/sw/local/lib_boost_LIBRARY_SEARCH_DIRS_DEBUG   = Boost_INCLUDE_DIR-NOTFOUND/lib;Boost_INCLUDE_DIR-NOTFOUND/../lib;Boost_INCLUDE_DIR-NOTFOUND/stage/lib;PATHS;C:/boost/lib;C:/boost;/sw/local/lib\n-- Looking for pthread_create\n-- Looking for pthread_create - found\n-- Found Threads: TRUE  \n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1852 ] Searching for SYSTEM_LIBRARY_RELEASE: boost_system-clang60-mt-;boost_system-clang60-mt;boost_system-clang60-mt;boost_system-mt-;boost_system-mt;boost_system-mt;boost_system-mt;boost_system\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1909 ] Searching for SYSTEM_LIBRARY_DEBUG: boost_system-clang60-mt-d-;boost_system-clang60-mt-d;boost_system-clang60-mt-d;boost_system-mt-d-;boost_system-mt-d;boost_system-mt-d;boost_system-mt;boost_system\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1852 ] Searching for THREAD_LIBRARY_RELEASE: boost_thread-clang60-mt-;boost_thread-clang60-mt;boost_thread-clang60-mt;boost_thread-mt-;boost_thread-mt;boost_thread-mt;boost_thread-mt;boost_thread\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1909 ] Searching for THREAD_LIBRARY_DEBUG: boost_thread-clang60-mt-d-;boost_thread-clang60-mt-d;boost_thread-clang60-mt-d;boost_thread-mt-d-;boost_thread-mt-d;boost_thread-mt-d;boost_thread-mt;boost_thread\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1852 ] Searching for FILESYSTEM_LIBRARY_RELEASE: boost_filesystem-clang60-mt-;boost_filesystem-clang60-mt;boost_filesystem-clang60-mt;boost_filesystem-mt-;boost_filesystem-mt;boost_filesystem-mt;boost_filesystem-mt;boost_filesystem\n-- [ /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:1909 ] Searching for FILESYSTEM_LIBRARY_DEBUG: boost_filesystem-clang60-mt-d-;boost_filesystem-clang60-mt-d;boost_filesystem-clang60-mt-d;boost_filesystem-mt-d-;boost_filesystem-mt-d;boost_filesystem-mt-d;boost_filesystem-mt;boost_filesystem\nCMake Error at /opt/cmake/share/cmake-3.14/Modules/FindBoost.cmake:2147 (message):\n  Unable to find the requested Boost libraries.\n\n  Unable to find the Boost header files.  Please set BOOST_ROOT to the root\n  directory containing Boost or BOOST_INCLUDEDIR to the directory containing\n  Boost's headers.\nCall Stack (most recent call first):\n  src/framework/CMakeLists.txt:205 (find_package)\n  CMakeLists.txt:36 (include)\n\n\nCMake Error at /opt/cmake/share/cmake-3.14/Modules/FindPackageHandleStandardArgs.cmake:137 (message):\n  Could NOT find Lua (missing: LUA_LIBRARY LUA_INCLUDE_DIR)\nCall Stack (most recent call first):\n  /opt/cmake/share/cmake-3.14/Modules/FindPackageHandleStandardArgs.cmake:378 (_FPHSA_FAILURE_MESSAGE)\n  src/framework/cmake/FindLua.cmake:17 (FIND_PACKAGE_HANDLE_STANDARD_ARGS)\n  src/framework/CMakeLists.txt:217 (find_package)\n  CMakeLists.txt:36 (include)\n\n\n-- Configuring incomplete, errors occurred!\nSee also \"/otclient/build/CMakeFiles/CMakeOutput.log\".\nThe command '/bin/sh -c emconfigure cmake -DCMAKE_CXX_LINK_FLAGS=-no-pie -DCMAKE_BUILD_TYPE=Release -DEMSCRIPTEN_GENERATE_BITCODE_STATIC_LIBRARIES=1 -DBoost_DEBUG=ON ..' returned a non-zero code: 1\n</code></pre>\n"
}