{
    "tags": [
        "html",
        "docker",
        "go",
        "webassembly"
    ],
    "owner": {
        "reputation": 976,
        "user_id": 207425,
        "user_type": "registered",
        "accept_rate": 69,
        "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1",
        "display_name": "pigfox",
        "link": "https://stackoverflow.com/users/207425/pigfox"
    },
    "is_answered": false,
    "view_count": 38,
    "answer_count": 1,
    "score": 1,
    "last_activity_date": 1590875721,
    "creation_date": 1590863688,
    "question_id": 62107035,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/62107035/docker-not-reflecting-changes-to-html-file",
    "title": "Docker not reflecting changes to html file",
    "body": "<p>I'm building a Webassembly app and Docker does not reflect changes to html file.\nBefore I build the Docker file I prune the system, hoping this would force a brand new build.\nAny pointers?</p>\n\n<pre><code>FROM golang:alpine AS builder\nENV GO111MODULE=on \\\n    CGO_ENABLED=0 \\\n    GOOS=linux \\\n    GOARCH=amd64 \n\nCOPY . .\nCOPY ./server.go .\nCOPY ./favicon.ico .\nCOPY ./assets /assets\nEXPOSE 8989\nCMD [\"go\", \"run\", \"./server.go\"]\n</code></pre>\n\n<p>This is how I run build the container.</p>\n\n<pre><code>docker system prune -a -f\ndocker build --no-cache -t test3 . \ndocker run -it test3 \n</code></pre>\n\n<p>The html file runs on localhost as the first version I started out with.\nThis is the server.go</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"net/http\"\n    \"strings\"\n)\n\ntype FileSystem struct {\n    fs http.FileSystem\n}\n\nvar listen = flag.String(\"listen\", \":8989\", \"listen address\")\nvar dir = flag.String(\"dir\", \".\", \"directory to serve\")\n\nfunc main() {\n    flag.Parse()\n    directory := \"./\"\n\n    fileServer := http.FileServer(FileSystem{http.Dir(directory)})\n    http.Handle(\"/\", fileServer)\n\n    fmt.Printf(\"Web server running. Listening on %q\", *listen)\n    err := http.ListenAndServe(*listen, http.FileServer(http.Dir(*dir)))\n    fmt.Printf(\"%v\\n\", err)\n}\n\nfunc (fs FileSystem) Open(path string) (http.File, error) {\n    f, err := fs.fs.Open(path)\n    if err != nil {\n        return nil, err\n    }\n\n    s, err := f.Stat()\n    if s.IsDir() {\n        index := strings.TrimSuffix(path, \"/\") + \"/index.html\"\n        if _, err := fs.fs.Open(index); err != nil {\n            return nil, err\n        }\n    }\n\n    return f, nil\n}\n</code></pre>\n\n<p>Finally the html file.</p>\n\n<pre><code>&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;Wasm 1.0&lt;/title&gt;\n        &lt;meta charset=\"utf-8\" /&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\" /&gt;\n        &lt;link rel=\"stylesheet\" href=\"./assets/css/main.css\" /&gt;\n        &lt;link rel=\"icon\" href=\"./favicon.ico?v=1\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-96x96.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-128x128.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-144x144.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-152x152.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-192x192.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-384x384.png\"&gt;\n        &lt;link rel=\"icon\" type=\"image/png\" sizes=\"96x96\" href=\"./assets/images/icons/icon-384x384.png\"&gt;\n        &lt;link rel=\"manifest\" href=\"./assests/manifest.json\"&gt;\n        &lt;meta name=\"msapplication-TileColor\" content=\"#ffffff\"&gt;\n        &lt;meta name=\"msapplication-TileImage\" content=\"/ms-icon-144x144.png\"&gt;\n        &lt;meta name=\"theme-color\" content=\"#ffffff\"&gt;\n    &lt;/head&gt;\n    &lt;body class=\"is-preload\"&gt;\n        &lt;script src=\"./assets/js/wasm_exec.js\"&gt;&lt;/script&gt;\n        &lt;script&gt;\n        wasm_filename = \"./assets/main.wasm\";   \n        function message(s){\n            document.getElementById(\"message\").textContent = s;\n        }\n\n        function load_wasm(){\n            if (!WebAssembly.instantiateStreaming) { // polyfill\n                WebAssembly.instantiateStreaming = async (resp, importObject) =&gt; {\n                    const source = await (await resp).arrayBuffer();\n                    return await WebAssembly.instantiate(source, importObject);\n                };\n            }\n\n            const go = new Go();\n\n            WebAssembly.instantiateStreaming(fetch(wasm_filename), go.importObject)\n            .then(results =&gt; { go.run(results.instance); })\n            .catch((err) =&gt; {\n                message(\"Error Loading WebAssembly - \" + err);\n                console.error(err);\n        //      location.reload(true);\n                });\n        }\n\n        load_wasm()\n    &lt;/script&gt;\n    &lt;nav id=\"nav\"&gt;\n        &lt;ul class=\"container\"&gt;\n            &lt;li&gt;&lt;a href=\"/\"&gt;Reload&lt;/a&gt;&lt;/li&gt;\n        &lt;/ul&gt;\n    &lt;/nav&gt;\n\n    &lt;div id=\"message\" class=\"message\"&gt;&lt;/div&gt;\n    &lt;article id=\"top\" class=\"wrapper style1\"&gt;\n        &lt;div class=\"container\"&gt;\n            &lt;div class=\"row\"&gt;\n                &lt;div class=\"col-4 col-5-large col-12-medium\"&gt;\n                    &amp;nbsp;\n                &lt;/div&gt;\n                &lt;div class=\"col-8 col-7-large col-12-medium\"&gt;\n                    &lt;header&gt;\n                        &lt;h1&gt;&lt;strong&gt;Wasm&lt;/strong&gt;.&lt;/h1&gt;\n                    &lt;/header&gt;\n                    &lt;a class=\"button large\" onclick=\"sum();\"&gt;Calculate&lt;/a&gt;\n                    &lt;div&gt;&lt;input type=\"text\" id=\"num1\"&gt;&lt;/div&gt;\n                    &lt;div&gt;&lt;input type=\"text\" id=\"num2\"&gt;&lt;/div&gt;\n                    &lt;div&gt;&lt;input type=\"text\" id=\"result\"&gt;&lt;/div&gt;\n                &lt;/div&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/article&gt;\n\n    &lt;script src=\"./assets/js/jquery.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/jquery.scrolly.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/browser.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/breakpoints.min.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/util.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/main.js\"&gt;&lt;/script&gt;\n    &lt;script src=\"./assets/js/app.js\"&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"
}