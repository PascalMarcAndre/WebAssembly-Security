{
    "tags": [
        "asp.net-core",
        ".net-core",
        "blazor"
    ],
    "owner": {
        "reputation": 2615,
        "user_id": 710275,
        "user_type": "registered",
        "accept_rate": 73,
        "profile_image": "https://www.gravatar.com/avatar/7b62ccbad906bd1b83743810f94b7f44?s=128&d=identicon&r=PG&f=1",
        "display_name": "Adolfo Perez",
        "link": "https://stackoverflow.com/users/710275/adolfo-perez"
    },
    "is_answered": false,
    "view_count": 62,
    "answer_count": 0,
    "score": 0,
    "last_activity_date": 1600629706,
    "creation_date": 1600629041,
    "last_edit_date": 1600629706,
    "question_id": 63982705,
    "content_license": "CC BY-SA 4.0",
    "link": "https://stackoverflow.com/questions/63982705/losing-ui-thread-after-sending-post-request-in-blazor",
    "title": "Losing UI thread after sending POST request in Blazor",
    "body": "<p>I'm building a basic CRUD app in Blazor and upon adding an Event record (in AddEvent.razor) I want to redirect the user to the list of Events. The Post request goes through but the execution is not coming back and not hitting my <code>NavigateTo</code> to redirect to Event List page.</p>\n<p>My Blazor solution is using WebAssembly hosting where I have:</p>\n<ul>\n<li>A Client Project (.NET Standard 2.1)</li>\n<li>Server Project REST API (dotnet core 3.1) using EntityFrameworkCore 3.1.8 and Microsoft.AspNetCore 3.2.1</li>\n<li>Shared Project (.NET Standard 2.1)</li>\n</ul>\n<p>This is how I configured my HttpClient in my Program.cs:</p>\n<pre><code>builder.Services.AddSingleton( new HttpClient\n{\n   BaseAddress = new Uri( builder.HostEnvironment.BaseAddress )\n});\n</code></pre>\n<p>I have an AddEvent.razor page where I add an Event entity though the <code>CreateEvent</code> method:</p>\n<pre><code>    &lt;div class=&quot;form-group&quot;&gt;\n        &lt;button class=&quot;btn btn-primary&quot; @onclick=&quot;@CreateEvent&quot;&gt;Save&lt;/button&gt;\n        &lt;button class=&quot;btn btn-warning&quot; @onclick=&quot;@cancel&quot;&gt;Cancel&lt;/button&gt;\n    &lt;/div&gt;\n</code></pre>\n<p>Here is the CreateEvent definitionP</p>\n<pre><code>private async Task CreateEvent()\n{\n    try\n    {\n        //While debugging seems like UI thread is lost after this line, it doesn't reach the Navigation statement below\n        var response = await Http.PostAsJsonAsync(&quot;/api/Event/create&quot;, evt);\n    }\n    catch (Exception ex)\n    {\n        Console.WriteLine(ex.Message);\n    }\n\n    await Task.Delay(500);\n    Navigation.NavigateTo(&quot;/fetchevent&quot;);\n}\n</code></pre>\n<p>My <code>EventController</code> class has this Post method:</p>\n<pre><code>// POST api/&lt;controller&gt;\n[HttpPost(&quot;create&quot;)]\npublic ActionResult Post([FromBody]Event evt)\n{\n    if (ModelState.IsValid){\n        _eventRepository.AddEvent(evt);\n        return Ok();\n    }\n    return BadRequest();\n}\n</code></pre>\n<p>My main problem is in the AddEvent.razor CreateEvent method where the execution seems to be lost after this line:</p>\n<p><code>var response = await Http.PostAsJsonAsync(&quot;/api/Event/create&quot;, evt);</code></p>\n<p>It never hits the navigation line below:</p>\n<p><code>Navigation.NavigateTo(&quot;/fetchevent&quot;);</code></p>\n<p>I have tried changing the signature of my EventController Post and wrapped the <code>Http.PostAsJsonAsync</code> call in a try/catch but it never hits the exception block. I also tried adding a delay after the Post but no luck...</p>\n<p>This is what I see in the logs when I click on AddEvent button:</p>\n<pre><code>Microsoft.AspNetCore.Hosting.Diagnostics: Information: Request starting HTTP/1.1 POST http://localhost:54114/api/Event/create application/json; charset=utf-8 105\nMicrosoft.AspNetCore.Routing.EndpointMiddleware: Information: Executing endpoint 'Paycor.PartnerManager.Server.Controllers.EventController.Post (Paycor.PartnerManager.Server)'\nMicrosoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker: Information: Route matched with {action = &quot;Post&quot;, controller = &quot;Event&quot;}. Executing controller action with signature Microsoft.AspNetCore.Mvc.ActionResult Post(Paycor.PartnerManager.Shared.Models.Event) on controller Paycor.PartnerManager.Server.Controllers.EventController (Paycor.PartnerManager.Server).\nMicrosoft.AspNetCore.Hosting.Diagnostics: Information: Request starting HTTP/1.1 GET http://localhost:54114/addevent?  \nMicrosoft.AspNetCore.Routing.EndpointMiddleware: Information: Executing endpoint 'Fallback {*path:nonfile}'\nMicrosoft.AspNetCore.StaticFiles.StaticFileMiddleware: Information: Sending file. Request path: '/index.html'. Physical path: 'C:\\Development\\GitRepos\\Prototypes\\Paycor.PartnerManager\\PartnerManager\\Client\\wwwroot\\index.html'\nMicrosoft.AspNetCore.Routing.EndpointMiddleware: Information: Executed endpoint 'Fallback {*path:nonfile}'\nMicrosoft.AspNetCore.Hosting.Diagnostics: Information: Request finished in 9.8383ms 200 text/html\nDebugging hotkey: Shift+Alt+D (when application has focus)\nMicrosoft.AspNetCore.Hosting.Diagnostics: Information: Request starting HTTP/1.1 GET http://localhost:54114/_framework/blazor.boot.json  \nMicrosoft.AspNetCore.StaticFiles.StaticFileMiddleware: Information: The file /_framework/blazor.boot.json was not modified\nMicrosoft.AspNetCore.Hosting.Diagnostics: Information: Request finished in 27.6226ms 304 application/json\nMicrosoft.AspNetCore.Mvc.StatusCodeResult: Information: Executing HttpStatusCodeResult, setting HTTP status code 200\nMicrosoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker: Information: Executed action Paycor.PartnerManager.Server.Controllers.EventController.Post (Paycor.PartnerManager.Server) in 556.5854ms\nMicrosoft.AspNetCore.Routing.EndpointMiddleware: Information: Executed endpoint 'Paycor.PartnerManager.Server.Controllers.EventController.Post (Paycor.PartnerManager.Server)'\nMicrosoft.AspNetCore.Hosting.Diagnostics: Information: Request finished in 592.7471ms 0 \n</code></pre>\n<p>Any ideas of why <code>PostAsJsonAsync</code> call is not returning and continuing with the rest of the statements in my <code>CreateEvent</code> method?</p>\n"
}